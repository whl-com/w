<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" href="logo-simple.svg" type="image/svg+xml">
    <title>店铺 - 打印模板编辑器</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="print-optimization.css">
    <link rel="stylesheet" href="mobile-fix.css">
    <link rel="stylesheet" href="mobile-properties-fix.css">
    <style>
        /* Word风格编辑器工具栏样式 */
        .editor-toolbar {
            background: #34495e;
            padding: 10px 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            border-bottom: 1px solid #2c3e50;
        }
        
        .tool-group {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 12px;
            background: #3b4b5b;
            border-radius: 6px;
        }
        
        .editor-btn {
            background: #4a6572;
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s;
        }
        
        .editor-btn:hover {
            background: #546e7a;
        }
        
        .editor-btn.active {
            background: #1976d2;
        }
        
        .editor-select, .editor-input {
            padding: 6px 8px;
            border: 1px solid #546e7a;
            border-radius: 4px;
            background: #2c3e50;
            color: white;
        }
        
        /* 页面控制 */
        .page-controls {
            padding: 15px 20px;
            background: #ecf0f1;
            border-bottom: 1px solid #bdc3c7;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .page-size-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 0 5px;
        }
        
        .page-size-btn.active {
            background: #2980b9;
        }
        
        /* 编辑器区域 */
        .editor-area {
            flex: 1;
            padding: 20px;
            overflow: auto;
            background: #fafafa;
            position: relative;
        }
        
        .page {
            background: white;
            min-height: 842px;
            width: 595px;
            margin: 0 auto;
            padding: 40px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border: 1px solid #ddd;
        }
        
        .page.landscape {
            width: 842px;
            min-height: 595px;
        }
        
        .editable-content {
            min-height: 400px;
            outline: none;
            line-height: 1.6;
            font-size: 14px;
        }
        
        .editable-content:focus {
            border: none;
            outline: none;
        }
        
        /* 打印预览 */
        .print-preview {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .print-preview-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
        }
        
        @media print {
            .header, .editor-toolbar, .properties-panel, .page-controls {
                display: none !important;
            }
            
            .main-content {
                margin: 0;
                padding: 0;
            }
            
            .template-container {
                margin: 0;
                border-radius: 0;
                box-shadow: none;
            }
            
            .page {
                box-shadow: none;
                border: none;
                margin: 0;
                width: 100% !important;
                height: 100% !important;
            }
        }
        
        /* 移动端适配 */
        @media (max-width: 768px) {
            .editor-toolbar {
                padding: 8px 12px;
                gap: 8px;
            }
            
            .tool-group {
                padding: 3px 8px;
            }
            
            .editor-area {
                padding: 15px;
            }
            
            .page {
                width: 100%;
                min-height: auto;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>打印模板编辑器</h1>
            <div class="toolbar">
                <button id="addText" class="tool-btn">添加文本</button>
                <button id="addImage" class="tool-btn">添加图片</button>
                <button id="scanText" class="tool-btn">扫描识别</button>
                <button id="saveTemplate" class="tool-btn">保存模板</button>
                <button id="loadTemplate" class="tool-btn">加载模板</button>
                <button id="print" class="tool-btn primary">打印预览</button>
            </div>
        </header>

        <!-- Word风格编辑器工具栏 -->
        <div class="editor-toolbar">
            <div class="tool-group">
                <select id="fontFamily" class="editor-select">
                    <option value="Microsoft YaHei">微软雅黑</option>
                    <option value="SimSun">宋体</option>
                    <option value="SimHei">黑体</option>
                    <option value="KaiTi">楷体</option>
                    <option value="Arial">Arial</option>
                </select>
                
                <select id="fontSize" class="editor-select">
                    <option value="1">8px</option>
                    <option value="2">10px</option>
                    <option value="3" selected>12px</option>
                    <option value="4">14px</option>
                    <option value="5">18px</option>
                    <option value="6">24px</option>
                </select>
            </div>
            
            <div class="tool-group">
                <button id="boldBtn" class="editor-btn" title="加粗"><b>B</b></button>
            </div>
            
            <div class="tool-group">
                <button id="alignLeft" class="editor-btn" title="左对齐">⬅️</button>
                <button id="alignCenter" class="editor-btn" title="居中">🔘</button>
                <button id="alignRight" class="editor-btn" title="右对齐">➡️</button>
            </div>
        </div>

        <!-- 页面控制 -->
        <div class="page-controls">
            <div>
                <span>页面设置: </span>
                <button id="portraitBtn" class="page-size-btn active">竖版 A4</button>
                <button id="landscapeBtn" class="page-size-btn">横版 A4</button>
            </div>
            <div>
                <span>缩放: </span>
                <select id="zoomLevel" class="editor-select" onchange="setZoom(this.value)">
                    <option value="0.8">80%</option>
                    <option value="1" selected>100%</option>
                    <option value="1.2">120%</option>
                </select>
            </div>
        </div>

        <main class="main-content">
            <div class="template-container">
                <div class="editor-area">
                    <div class="page" id="page">
                        <div 
                            class="editable-content" 
                            id="editor" 
                            contenteditable="true"
                            oninput="updateStatus()"
                        >
                            <h1 style="text-align: center; color: #2c3e50;">打印模板编辑器</h1>
                            <p style="text-align: center; color: #7f8c8d;">在此处编辑您的打印模板内容</p>
                            
                            <hr style="margin: 30px 0; border: 1px solid #ecf0f1;">
                            
                            <h2>使用说明</h2>
                            <ul>
                                <li>直接点击文本进行编辑</li>
                                <li>使用工具栏设置字体、大小、加粗和对齐方式</li>
                                <li>支持横版和竖版打印</li>
                                <li>使用左侧按钮添加文本和图片元素</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <div class="properties-panel" id="propertiesPanel">
            <h3>属性设置</h3>
            
            <!-- 文本元素属性 -->
            <div id="textProperties" class="element-properties">
                <div class="property-group">
                    <label>内容:</label>
                    <textarea id="contentInput" placeholder="输入内容..."></textarea>
                </div>
                <div class="property-group">
                    <label>字体大小:</label>
                    <input type="number" id="fontSizeInput" value="14" min="8" max="72">
                </div>
                <div class="property-group">
                    <label>对齐方式:</label>
                    <select id="alignInput">
                        <option value="left">左对齐</option>
                        <option value="center">居中</option>
                        <option value="right">右对齐</option>
                    </select>
                </div>
                <div class="property-group">
                    <label>字体样式:</label>
                    <div style="display: flex; gap: 10px;">
                        <label style="display: flex; align-items: center; gap: 5px;">
                            <input type="checkbox" id="boldInput">
                            加粗
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- 图片元素属性 -->
            <div id="imageProperties" class="element-properties" style="display: none;">
                <div class="property-group">
                    <label>宽度:</label>
                    <input type="number" id="imageWidthInput" value="100" min="50" max="300">
                </div>
                <div class="property-group">
                    <label>高度:</label>
                    <input type="number" id="imageHeightInput" value="100" min="50" max="300">
                </div>
                <div class="property-group">
                    <label>替换图片:</label>
                    <input type="file" id="replaceImageInput" accept="image/*" style="display: none;">
                    <button id="replaceImageBtn" class="tool-btn">选择新图片</button>
                </div>
            </div>
            
            <div class="property-group">
                <button id="saveProps" class="tool-btn primary">保存</button>
                <button id="deleteElement" class="tool-btn danger">删除</button>
            </div>
        </div>

        <!-- 打印预览模态框 -->
        <div class="print-preview" id="printPreview">
            <div class="print-preview-content">
                <h2>打印预览</h2>
                <div id="previewContent"></div>
                <div style="margin-top: 20px; text-align: center;">
                    <button id="confirmPrint" class="editor-btn">打印</button>
                    <button id="closePreview" class="editor-btn" style="background: #95a5a6;">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script src="script.js"></script>
    <script src="mobile-events.js"></script>
</body>
</html>